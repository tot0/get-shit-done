---
phase: 01-continuation-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/workflows/new-project.md
  - get-shit-done/workflows/new-milestone.md
  - get-shit-done/workflows/transition.md
  - get-shit-done/workflows/verify-work.md
autonomous: true

must_haves:
  truths:
    - "Every workflow loop that says 'loop until' or 'go to' has an explicit 'MUST NOT end your turn' warning before the loop body"
    - "Every transition point within a loop has an explicit 'DO NOT end your turn here' inline enforcement"
    - "Every loop has exactly one marked natural pause/exit point"
    - "The transition.md auto-continuations have inline enforcement between text output and SlashCommand invocation"
    - "All continuation cue language matches the canonical quick-001 phrasing exactly"
  artifacts:
    - path: "get-shit-done/workflows/new-project.md"
      provides: "Continuation cues for questioning loop (line ~106) and roadmap approval loop (line ~819)"
      contains: "MUST NOT end your turn"
    - path: "get-shit-done/workflows/new-milestone.md"
      provides: "Continuation cues for roadmap approval loop (line ~304)"
      contains: "MUST NOT end your turn"
    - path: "get-shit-done/workflows/transition.md"
      provides: "Inline continuation enforcement for yolo-mode auto-continuations (lines ~433, ~478)"
      contains: "DO NOT end your turn"
    - path: "get-shit-done/workflows/verify-work.md"
      provides: "Continuation cues for test presentation loop (line ~255)"
      contains: "MUST NOT end your turn"
  key_links:
    - from: "get-shit-done/workflows/new-project.md"
      to: "quick-001 discuss-phase.md pattern"
      via: "Identical 3-component continuation cue structure"
      pattern: "CRITICAL: Loop continuation"
    - from: "get-shit-done/workflows/new-milestone.md"
      to: "get-shit-done/workflows/new-project.md"
      via: "Same roadmap approval loop pattern"
      pattern: "CRITICAL: Loop continuation"
---

<objective>
Add explicit belt-and-suspenders continuation cues to all 5 implicit loop/continuation patterns across 4 workflow files, using the proven quick-001 3-component pattern. This prevents non-Claude models (GPT-5.3-Codex, Gemini) from prematurely ending their turn mid-loop.

Purpose: Non-Claude models don't infer continuation from implicit "loop until" / "go to" instructions. Without explicit "MUST NOT end your turn" language, these models stop mid-workflow, breaking the entire GSD loop flow.
Output: 4 modified workflow files with ~20-30 lines of purely additive continuation cues.
</objective>

<execution_context>
@/Users/lupickup/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/lupickup/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-continuation-fixes/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add 3-component continuation cues to the three approval/questioning loops</name>
  <files>
    get-shit-done/workflows/new-project.md
    get-shit-done/workflows/new-milestone.md
  </files>
  <action>
Apply the quick-001 3-component continuation pattern to 3 loops across 2 files. All insertions are ADDITIVE ONLY — do not delete, rephrase, or reorder any existing text. Use the EXACT canonical phrasing from the quick-001 discuss-phase.md fix.

**Loop 1: new-project.md — Questioning Loop (around line 106)**

Before line 106 ("Decision gate:"), insert Component 1:
```
**CRITICAL: Loop continuation — This step includes a LOOP for the decision gate below. You MUST NOT end your turn until the user selects "Create PROJECT.md". After receiving ANY tool response (including "Keep exploring"), you MUST immediately continue processing — do NOT end your turn or wait for further input.**
```

After line 116 ("If "Keep exploring" — ask what they want to add, or identify gaps and probe naturally."), insert Component 2:
```
**DO NOT end your turn here.** Immediately ask what they want to add, or identify gaps and probe naturally. The user's selection of "Keep exploring" is NOT a signal to stop — it is a signal to continue the conversation and loop back to the decision gate.
```

After line 118 ("Loop until "Create PROJECT.md" selected."), insert Component 3:
```
This is the ONLY point where the questioning loop exits — when the user selects "Create PROJECT.md". Proceed to Step 4.
```

**Loop 2: new-project.md — Roadmap Approval Loop (around line 819)**

Before line 819 ("CRITICAL: Ask for approval before committing:"), insert Component 1:
```
**CRITICAL: Loop continuation — This is a LOOP for roadmap approval. You MUST NOT end your turn until the user selects "Approve". After receiving ANY tool response (including "Adjust phases" or "Review full file"), you MUST immediately continue processing — do NOT end your turn.**
```

After line 846 (the closing of the Task spawn block: ``, description="Revise roadmap")`), before "- Present revised roadmap", insert Component 2:
```
  **DO NOT end your turn here.** Immediately present the revised roadmap inline and re-ask the approval question. The user's selection of "Adjust phases" is NOT a signal to stop — it is a signal to revise and re-present.
```

After line 850 ("**If "Review full file":** Display raw `cat .planning/ROADMAP.md`, then re-ask."), insert Component 2:
```
**DO NOT end your turn here.** After displaying the file, immediately re-present the approval question via AskUserQuestion.
```

After the "Loop until user approves" line (line 848), insert Component 3:
```
This is the ONLY point where the roadmap approval loop exits — when the user selects "Approve". Proceed to commit.
```

**Loop 3: new-milestone.md — Roadmap Approval Loop (around line 304)**

Before line 304 ("**Ask for approval** via AskUserQuestion:"), insert Component 1:
```
**CRITICAL: Loop continuation — This is a LOOP for roadmap approval. You MUST NOT end your turn until the user selects "Approve". After receiving ANY tool response (including "Adjust" or "Review"), you MUST immediately continue processing — do NOT end your turn.**
```

After line 309 ("**If "Adjust":** Get notes, re-spawn roadmapper with revision context, loop until approved."), insert Component 2:
```
**DO NOT end your turn here.** After the roadmapper returns the revised roadmap, immediately present it inline and re-ask the approval question. The user's selection of "Adjust" is NOT a signal to stop — it is a signal to revise and re-present.
```

After line 310 ("**If "Review":** Display raw ROADMAP.md, re-ask."), insert Component 2:
```
**DO NOT end your turn here.** After displaying the file, immediately re-present the approval question via AskUserQuestion.
```

After the "Adjust" line's "loop until approved" text (line 309), also insert Component 3:
```
This is the ONLY point where the roadmap approval loop exits — when the user selects "Approve". Proceed to commit.
```

**Important constraints:**
- Use EXACT phrasing "MUST NOT end your turn" and "DO NOT end your turn here" — these are the canonical phrases.
- Insertions are new lines between existing lines. Never modify existing lines.
- Read each file first, locate the exact insertion points by matching the surrounding text (line numbers are approximate), then make the edits.
  </action>
  <verify>
Run these greps to confirm all components were inserted:

1. `grep -n "CRITICAL: Loop continuation" get-shit-done/workflows/new-project.md` — should show 2 matches (questioning loop + roadmap approval loop)
2. `grep -n "DO NOT end your turn here" get-shit-done/workflows/new-project.md` — should show 3 matches (1 in questioning loop + 2 in roadmap approval loop)
3. `grep -n "ONLY point where" get-shit-done/workflows/new-project.md` — should show 2 matches
4. `grep -n "CRITICAL: Loop continuation" get-shit-done/workflows/new-milestone.md` — should show 1 match
5. `grep -n "DO NOT end your turn here" get-shit-done/workflows/new-milestone.md` — should show 2 matches
6. `grep -n "ONLY point where" get-shit-done/workflows/new-milestone.md` — should show 1 match
7. `git diff --stat` — should show only additions, no deletions in existing lines
  </verify>
  <done>
new-project.md has continuation cues on both the questioning loop (Step 3 decision gate) and the roadmap approval loop (Step 8). new-milestone.md has continuation cues on its roadmap approval loop (Step 10). All 3 loops have Component 1 (CRITICAL warning), Component 2 (inline enforcement at every transition point), and Component 3 (natural exit marker). No existing text was modified.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add continuation cues to transition auto-continuations and verify-work test loop</name>
  <files>
    get-shit-done/workflows/transition.md
    get-shit-done/workflows/verify-work.md
  </files>
  <action>
Apply continuation cues to the remaining 2 patterns across 2 files. All insertions are ADDITIVE ONLY. Use EXACT canonical phrasing.

**Pattern 4: transition.md — Yolo Mode Auto-Continuations (lines ~433 and ~478)**

These are NOT loops — they are single-shot text→tool-call continuations. Only Component 2 is needed.

After line 433 ("⚡ Auto-continuing: Plan Phase [X+1] in detail" inside the code block), before line 436 ("Exit skill and invoke SlashCommand..."), insert Component 2:
```
**DO NOT end your turn after displaying the above message.** You MUST immediately invoke the SlashCommand below. The "Auto-continuing" message is NOT the end of your turn — it is a preamble to the tool invocation that follows.
```

After line 478 ("⚡ Auto-continuing: Complete milestone and archive" inside the code block), before line 481 ("Exit skill and invoke SlashCommand..."), insert Component 2:
```
**DO NOT end your turn after displaying the above message.** You MUST immediately invoke the SlashCommand below. The "Auto-continuing" message is NOT the end of your turn — it is a preamble to the tool invocation that follows.
```

Note: The insertion point is BETWEEN the closing ``` of the code block and the "Exit skill and invoke" line. Read the file carefully to locate the exact position — the code block ends with ``` and then the next line is the instruction to invoke. The continuation cue goes between them.

**Pattern 5: verify-work.md — Test Presentation Loop (around line 255)**

This loop has a subtlety: there IS a legitimate pause within the loop (at `present_test`, waiting for user test response), but the transition from `process_response` back to `present_test` must NOT include an extra turn-ending.

Before line 250 ("**After any response:**"), insert Component 1:
```
**CRITICAL: Loop continuation — After processing the user's response below, if more tests remain, you MUST NOT end your turn. You MUST immediately update the Current Test section and present the next test. Do NOT end your turn between processing a response and presenting the next test.**
```

After line 255 ("If more tests remain → Update Current Test, go to `present_test`"), insert Component 2:
```
**DO NOT end your turn here.** Immediately update the Current Test section in the UAT file and present the next test to the user. The completion of processing one test response is NOT a signal to stop — it is a signal to continue to the next test.
```

After line 256 ("If no more tests → Go to `complete_session`"), insert Component 3:
```
This is the ONLY point where the test loop exits — when no more tests remain. Proceed to `complete_session`.
```

**Important constraints:**
- Use EXACT phrasing "MUST NOT end your turn" and "DO NOT end your turn" — these are the canonical phrases.
- Insertions are new lines between existing lines. Never modify existing lines.
- Read each file first, locate the exact insertion points by matching the surrounding text (line numbers are approximate), then make the edits.
  </action>
  <verify>
Run these greps to confirm all components were inserted:

1. `grep -n "DO NOT end your turn" get-shit-done/workflows/transition.md` — should show 2 matches (Route A + Route B auto-continuations)
2. `grep -n "CRITICAL: Loop continuation" get-shit-done/workflows/verify-work.md` — should show 1 match
3. `grep -n "DO NOT end your turn here" get-shit-done/workflows/verify-work.md` — should show 1 match
4. `grep -n "ONLY point where" get-shit-done/workflows/verify-work.md` — should show 1 match
5. `git diff --stat` — should show only additions across all 4 files, no deletions in existing lines

Final cross-file verification:
6. `grep -rn "MUST NOT end your turn" get-shit-done/workflows/` — should show matches in new-project.md (2), new-milestone.md (1), verify-work.md (1) = 4 total
7. `grep -rn "DO NOT end your turn" get-shit-done/workflows/` — should show matches in new-project.md (3), new-milestone.md (2), transition.md (2), verify-work.md (1) = 8 total
  </verify>
  <done>
transition.md has inline continuation enforcement on both yolo-mode auto-continuation paths (Route A phase transition and Route B milestone completion). verify-work.md has the full 3-component pattern on its test presentation loop, with the subtlety handled: the legitimate pause (waiting for user test response at present_test) is preserved, while the process_response→present_test transition is explicitly marked as must-continue. No existing text was modified.
  </done>
</task>

</tasks>

<verification>
After both tasks complete, verify the full phase goal:

1. **All 5 patterns fixed:** `grep -rn "MUST NOT end your turn\|DO NOT end your turn" get-shit-done/workflows/{new-project,new-milestone,transition,verify-work}.md` shows cues in all 4 files.

2. **No implicit loops remain:** Search for bare "loop until" or "go to" without nearby continuation cues:
   - `grep -n "Loop until\|loop until" get-shit-done/workflows/new-project.md` — each match should have a "MUST NOT end your turn" within 15 lines above it
   - `grep -n "loop until\|Loop until" get-shit-done/workflows/new-milestone.md` — same check
   - `grep -n "go to \`present_test\`" get-shit-done/workflows/verify-work.md` — should have "DO NOT end your turn here" within 5 lines

3. **Purely additive:** `git diff --stat` shows only line additions, not modifications to existing lines. The diff should contain only green `+` lines, no red `-` lines (except possibly the `@@` headers changing).

4. **Canonical phrasing consistent:** `grep -rn "CRITICAL: Loop continuation" get-shit-done/workflows/` — all matches use the same "CRITICAL: Loop continuation" prefix.
</verification>

<success_criteria>
- All 5 implicit continuation patterns (CONT-01 through CONT-05) have explicit continuation cues
- The new-project.md questioning loop and roadmap approval loop both have all 3 components
- The new-milestone.md roadmap approval loop has all 3 components
- The transition.md auto-continuations (both Route A and Route B) have inline enforcement
- The verify-work.md test presentation loop has all 3 components
- No workflow file contains a bare "loop until" or "go to" without an accompanying explicit continuation instruction
- All changes are purely additive — no existing text was modified or deleted
- All continuation cue phrasing matches the canonical quick-001 pattern exactly
</success_criteria>

<output>
After completion, create `.planning/phases/01-continuation-fixes/01-01-SUMMARY.md`
</output>
