---
phase: 03-gsd-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - commands/gsd/pr-branch.md
  - get-shit-done/bin/gsd-tools.js
  - get-shit-done/templates/config.json
autonomous: true

must_haves:
  truths:
    - "User can type /gsd:pr-branch and see commit classification + PR branch results"
    - "User can type /gsd:pr-branch --dry-run and see a preview without modification"
    - "pr_branch_auto_sync config field is readable by loadConfig() with default false"
  artifacts:
    - path: "commands/gsd/pr-branch.md"
      provides: "Slash command definition for /gsd:pr-branch"
      contains: "gsd-tools.js pr-branch"
    - path: "get-shit-done/bin/gsd-tools.js"
      provides: "pr_branch_auto_sync config field in loadConfig()"
      contains: "pr_branch_auto_sync"
    - path: "get-shit-done/templates/config.json"
      provides: "Default config with pr_branch section"
      contains: "auto_sync"
  key_links:
    - from: "commands/gsd/pr-branch.md"
      to: "get-shit-done/bin/gsd-tools.js"
      via: "Bash tool invocation"
      pattern: "gsd-tools\\.js pr-branch"
---

<objective>
Create the `/gsd:pr-branch` slash command and add auto_sync config support to gsd-tools.js.

Purpose: Enables AI agents to invoke PR branch filtering via slash command (INTG-02), and adds the config plumbing for auto-sync (INTG-03 prep).
Output: Slash command file + config extension
</objective>

<execution_context>
@/Users/lupickup/.config/Claude/get-shit-done/workflows/execute-plan.md
@/Users/lupickup/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-gsd-integration/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /gsd:pr-branch slash command</name>
  <files>commands/gsd/pr-branch.md</files>
  <action>
Create `commands/gsd/pr-branch.md` following the exact pattern of existing commands (e.g., `commands/gsd/progress.md`, `commands/gsd/update.md`).

YAML frontmatter:
- `name: gsd:pr-branch`
- `description: Create or update a filtered PR branch without planning files`
- `argument-hint: "[--dry-run] [--base branch]"`
- `allowed-tools:` — Bash, Read

The command is a thin wrapper — ALL logic lives in gsd-tools.js. The command:

1. Invokes `node ~/.claude/get-shit-done/bin/gsd-tools.js pr-branch $ARGUMENTS` via Bash
2. Presents the tool output to the user, highlighting:
   - Number of commits cherry-picked vs skipped
   - PR branch name
   - Any mixed commits that were skipped
   - Any conflicts that occurred

The `<objective>` should explain what the command does: creates or updates a PR branch containing only code commits (no .planning/ files). Supports `--dry-run` for preview and `--base branch` to override the default base branch.

The `<process>` section should:
1. Run the tool via Bash
2. Present results with appropriate formatting

Use `~/.claude/get-shit-done/bin/gsd-tools.js` as the path — the installer handles path replacement for OpenCode (`~/.config/opencode/`) and Gemini (`~/.gemini/`).

Do NOT add any logic to the command file itself. No config reading, no git operations, no error handling beyond presenting tool output.
  </action>
  <verify>
Verify the file exists and has valid YAML frontmatter:
```bash
head -10 commands/gsd/pr-branch.md
```
Verify it references gsd-tools.js pr-branch:
```bash
grep "gsd-tools.js pr-branch" commands/gsd/pr-branch.md
```
  </verify>
  <done>commands/gsd/pr-branch.md exists with valid frontmatter (name: gsd:pr-branch, allowed-tools: Bash + Read), references gsd-tools.js pr-branch in process section, contains no embedded logic</done>
</task>

<task type="auto">
  <name>Task 2: Add auto_sync config support to gsd-tools.js and config template</name>
  <files>get-shit-done/bin/gsd-tools.js, get-shit-done/templates/config.json</files>
  <action>
**In `get-shit-done/bin/gsd-tools.js`**, add `pr_branch_auto_sync` to the `loadConfig()` function:

1. Add to `defaults` object: `pr_branch_auto_sync: false,` (after the existing `pr_branch_filter_paths` line)
2. Add to the return object: `pr_branch_auto_sync: get('pr_branch_auto_sync', { section: 'pr_branch', field: 'auto_sync' }) ?? defaults.pr_branch_auto_sync,` (after the existing `pr_branch_filter_paths` line)

This follows the exact same pattern as `pr_branch_base` and `pr_branch_filter_paths` — flat key with nested section fallback.

**In `get-shit-done/templates/config.json`**, add a `pr_branch` section to the template:

```json
"pr_branch": {
  "auto_sync": false
}
```

Add this after the `"safety"` section (before the closing `}`). This is the default config template that gets copied to `.planning/config.json` when a new project is created.

Do NOT add `base_branch` or `filter_paths` to the template — those are already handled by `loadConfig()` defaults and don't need to be in the template (they're advanced options).
  </action>
  <verify>
Verify loadConfig has the new field:
```bash
grep "pr_branch_auto_sync" get-shit-done/bin/gsd-tools.js
```
Verify config template has pr_branch section:
```bash
grep -A2 "pr_branch" get-shit-done/templates/config.json
```
Verify gsd-tools.js still parses without syntax errors:
```bash
node -e "require('./get-shit-done/bin/gsd-tools.js')" 2>&1 | head -5
```
  </verify>
  <done>loadConfig() returns pr_branch_auto_sync (default false), reads from config.pr_branch.auto_sync nested path; config.json template includes pr_branch.auto_sync: false</done>
</task>

</tasks>

<verification>
- `commands/gsd/pr-branch.md` exists with correct frontmatter and process section
- `loadConfig()` in gsd-tools.js returns `pr_branch_auto_sync` field
- `get-shit-done/templates/config.json` includes `pr_branch.auto_sync` default
- No syntax errors in gsd-tools.js
</verification>

<success_criteria>
- Slash command file follows established GSD command patterns
- Config plumbing supports auto_sync reading from both flat and nested config formats
- All existing gsd-tools.js functionality unchanged (no regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/03-gsd-integration/03-01-SUMMARY.md`
</output>
